\documentclass[]{ltjsarticle}
\usepackage{luatexja}


\usepackage{amsmath, amssymb, latexsym, mathrsfs, bm}
\usepackage[braket, qm]{qcircuit}
%\usepackage{braket}
\usepackage{graphicx}
\usepackage{grffile}
\usepackage[svgnames]{xcolor}
\usepackage[
     colorlinks        = true,
     unicode           = true,
     pdfstartview      = FitV,
     linktocpage       = true,
     linkcolor         = OrangeRed,
     citecolor         = MediumSeaGreen,
     urlcolor          = RoyalBlue,
     bookmarks         = true,
     bookmarksnumbered = true,
     pdftitle={},
     pdfauthor={筒井翔一朗}
]{hyperref}


%% Numerical constats
\newcommand{\e}{\mathrm{e}}
\newcommand{\im}{\mathrm{i}\mkern1mu}


%% Derivative
\newcommand{\del}{\partial}


%% Mathcal
\newcommand{\calD}{\mathcal{D}}


%% Hat (used for operator on Hilbert space)
\newcommand{\hH}{\hat{H}}


%% Mathematical symbols
\DeclareMathOperator{\tr}{tr}
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\Tprod}{\mathrm{T}}
\renewcommand{\Re}{\mathrm{Re}}
\renewcommand{\Im}{\mathrm{Im}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}


\title{量子計算ミニマム}


\author{筒井翔一朗}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\maketitle
\tableofcontents


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Notation}
Qubit
\begin{align}
    \ket{0} 
    = 
    \begin{pmatrix}
    1 \\ 0    
    \end{pmatrix}, \quad 
    %
    \ket{1} 
    = 
    \begin{pmatrix}
    0 \\ 1    
    \end{pmatrix}, \quad 
\end{align}

Kronecker積
\begin{align}
    A \otimes B 
    \equiv
    \begin{pmatrix}
        a_{11}B & \dots & a_{1N}B \\
        \vdots & \ddots & \vdots \\
        a_{N1}B & \dots & a_{NN}B
    \end{pmatrix}
\end{align}

Pauliゲート
\begin{align}
    X = 
    \begin{pmatrix}
    0 & 1 \\ 1 & 0     
    \end{pmatrix},\quad 
    %
    Y = 
    \begin{pmatrix}
    0 & -i \\ i & 0     
    \end{pmatrix},\quad 
    %
    Z = 
    \begin{pmatrix}
    1 & 0 \\ 0 & -1     
    \end{pmatrix} 
\end{align}

Hadamardゲート
\begin{align}
    H 
    = 
    \frac{1}{\sqrt{2}}
    \begin{pmatrix}
        1 & 1 \\
        1 & -1
    \end{pmatrix}
\end{align}

一般位相ゲート
\begin{align}
    R_l
    =
    \begin{pmatrix}
        1 & 0 \\
        0 & e^{i\frac{2\pi}{2^l}}
    \end{pmatrix}
\end{align}

整数$k$の2進数表記
\begin{align}
    (k)_2 = i_1 i_2 \cdots, \quad i_n = 0, 1
\end{align}

例
\begin{align}
    (0)_2 &= 0 \\
    (1)_2 &= 1 \\
    (2)_2 &= 10 \\
    (3)_2 &= 11 \\
    (4)_2 &= 100 \\
    (5)_2 &= 101 \\
    (6)_2 &= 110 \\
    (7)_2 &= 111 \\
    (8)_2 &= 1000 \\
    (9)_2 &= 1001 \\
    (10)_2 &= 1010 \\
    (11)_2 &= 1011 \\
    (12)_2 &= 1100 \\
    (13)_2 &= 1101
\end{align}

小数を含む2進数表記
\begin{align}
    (k)_2 
    =
    k_1 \cdots k_{l-1}. k_l \cdots k_n
    =
    \cdots + k_{l-1} 2^{0}
    +
    \frac{k_l}{2^1}
    +
    \frac{k_{l+1}}{2^2}
    +
    \cdots
    +
    \frac{k_n}{2^{n-l+1}}
\end{align}


\section{基本的な計算結果}
Xゲートは
\begin{align}
    X\ket{0} 
    &=
    \begin{pmatrix}
        0 & 1 \\ 1 & 0 
    \end{pmatrix} 
    \begin{pmatrix}
        1 \\ 0 
    \end{pmatrix} 
    =
    \begin{pmatrix}
        0 \\ 1 
    \end{pmatrix}
    =
    \ket{1}  \\
    %
    X\ket{1} 
    &=
    \begin{pmatrix}
        0 & 1 \\ 1 & 0 
    \end{pmatrix} 
    \begin{pmatrix}
        0 \\ 1 
    \end{pmatrix} 
    =
    \begin{pmatrix}
        1 \\ 0 
    \end{pmatrix}
    =
    \ket{0}
\end{align}
のように0,1を反転させるので、NOTの役割をする。


アダマールゲートによる演算。
\begin{align}
    H \ket{0}
    &=
    \frac{1}{\sqrt{2}}
    \begin{pmatrix}
        1 & 1 \\
        1 & -1
    \end{pmatrix}
    \begin{pmatrix}
        1 \\ 0
    \end{pmatrix}
    =
    \frac{1}{\sqrt{2}}
    \begin{pmatrix}
        1 \\ 1
    \end{pmatrix}
    =
    \frac{\ket{0} + \ket{1}}{\sqrt{2}} \\
    %
    H \ket{1}
    &=
    \frac{1}{\sqrt{2}}
    \begin{pmatrix}
        1 & 1 \\
        1 & -1
    \end{pmatrix}
    \begin{pmatrix}
        0 \\ 1
    \end{pmatrix}
    =
    \frac{1}{\sqrt{2}}
    \begin{pmatrix}
        1 \\ -1
    \end{pmatrix}
    =
    \frac{\ket{0} - \ket{1}}{\sqrt{2}}
\end{align}

量子状態と測定確率。
規格化された状態
\begin{align}
    \ket{\psi} 
    =
    \frac{\alpha}{\sqrt{|\alpha|^2+|\alpha|^2}} 
    \ket{0}   
    +
    \frac{\beta}{\sqrt{|\alpha|^2+|\alpha|^2}} 
    \ket{1}   
\end{align}
があったとする。
この状態を測定して$\ket{0}$が観測される確率は
\begin{align}
    P_0
    =
    |\ket{0}\bra{0}\ket{\psi}|^2
    =
    |\bra{0}\ket{\psi}|^2
    =
    \frac{|\alpha|^2}{|\alpha|^2 + |\beta|^2}
\end{align}
である。


10進数と2進数の関係。
$(k)_2 = k_1 k_2 \cdots k_n$のとき
\begin{align}
    k 
    = 
    k_1 2^{n-1}
    +
    k_2 2^{n-2}
    +
    \cdots
    +
    k_n 2^0
\end{align}
例えば、
\begin{align}
    9 
    = 
    1 \times 2^{3}
    +
    0 \times 2^{2}
    +
    0 \times 2^{1}
    +
    1 \times 2^0
\end{align}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{測定について}
ここでは有限次元のHilbert空間のみ考える。
半正定値行列のセット$\{F_i\}$で
\begin{align}
    \sum_i F_i = I
\end{align}
を満たすようなものを
positive operator-valued measure (POVM)
と呼ぶ。
量子状態$\rho$を測定して、出力$i$が得られる確率は
\begin{align}
    \tr(\rho F_i)    
\end{align}
で与えられる。

例として、純粋状態
\begin{align}
    \rho = \ket{\psi}\bra{\psi}, \quad 
    \ket{\psi} 
    =
    \frac{\alpha}{|\alpha|^2+|\alpha|^2} 
    \ket{0}   
    +
    \frac{\beta}{|\alpha|^2+|\alpha|^2}
    \ket{1}   
\end{align}
と、POVM
\begin{align}
    F_0 = \frac{1 + Z}{2}
    = \begin{pmatrix}
        1 & 0 \\ 0 & 0
    \end{pmatrix}, \quad 
    F_1 = \frac{1 - Z}{2} 
    = \begin{pmatrix}
        0 & 0 \\ 0 & 1
    \end{pmatrix}, \quad 
\end{align}
を考える。
測定によって出力0が得られる確率は
\begin{align}
    \tr(\rho F_0)
    =
    \tr(\ket{\psi}\bra{\psi} F_0)
    =
    \bra{\psi}F_0\ket{\psi}
    =
    \frac{\alpha^2}{|\alpha|^2+|\alpha|^2}
\end{align}
出力1が得られる確率は
\begin{align}
    \tr(\rho F_1)
    =
    \tr(\ket{\psi}\bra{\psi} F_1)
    =
    \bra{\psi}F_1\ket{\psi}
    =
    \frac{\beta^2}{|\alpha|^2+|\alpha|^2}
\end{align}
である。
これはいわゆるBornの規則である。


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{基本的な量子アルゴリズム}

\subsection{アダマールテスト}
$U$をユニタリー演算子とする。
以下のゲート
\[ 
    \Qcircuit 
    @C=1em @R=1em 
    {
        \lstick{\ket{0}}              & \gate{H} & \ctrl{1} & \gate{H} & \meter \\
        \lstick{\ket{\psi_\text{in}}} & \qw      & \gate{U} & \qw      & \rstick{\ket{\psi_\text{out}}}\qw
    }
\]
を考える。
control U gateを式で表すと、
\begin{align}
    \ket{0}\bra{0}\otimes I + \ket{1}\bra{1}\otimes U
\end{align}
であることに注意して、この回路を式で書くと、
測定の直前の状態は
\begin{align}
    &(H\otimes I) 
    (\ket{0}\bra{0}\otimes I + \ket{1}\bra{1}\otimes U)
    (H\otimes I) 
    \ket{0}\ket{\psi_\text{in}} \\
    =
    &(H\otimes I)
    (\ket{0}\bra{0}\otimes I + \ket{1}\bra{1}\otimes U)
    \frac{\ket{0}\ket{\psi_\text{in}} + \ket{1}\ket{\psi_\text{in}}}{\sqrt{2}} \\
    =
    &(H\otimes I)
    \left(
        \frac{\ket{0}\ket{\psi_\text{in}}}{\sqrt{2}}
        +
        \frac{\ket{1}U\ket{\psi_\text{in}}}{\sqrt{2}}
    \right) \\
    =
    &\frac{1}{\sqrt{2}}
    (H\otimes I)
    \left(
        \ket{0}\ket{\psi_\text{in}}
        +
        \ket{1}U\ket{\psi_\text{in}}
    \right) \\
    =
    &\frac{1}{\sqrt{2}}
    \left(
        \frac{\ket{0} + \ket{1}}{\sqrt{2}}\ket{\psi_\text{in}}
        +
        \frac{\ket{0} - \ket{1}}{\sqrt{2}}U\ket{\psi_\text{in}}
    \right) \\
    =
    &
    \frac{\ket{0} + \ket{1}}{2}\ket{\psi_\text{in}}
    +
    \frac{\ket{0} - \ket{1}}{2}U\ket{\psi_\text{in}} \\
    =
    &
    \ket{0}\frac{I + U}{2}\ket{\psi_\text{in}}
    +
    \ket{1}\frac{I - U}{2}\ket{\psi_\text{in}}
\end{align}
となる。
第一のqubitが$\ket{0}$である確率は
\begin{align}
    p_0
    &=
    \left|
        (\ket{0}\bra{0} \otimes I)
        \left(
            \ket{0}\frac{I + U}{2}\ket{\psi_\text{in}}
            +
            \ket{1}\frac{I - U}{2}\ket{\psi_\text{in}}
        \right)
    \right|^2 \\
    &=
    \left|
        \ket{0}\frac{I + U}{2}\ket{\psi_\text{in}}
    \right|^2 \\
    &=
    \left(
        \bra{\psi_\text{in}}\frac{I + U^\dagger}{2}\bra{0}
    \right)
    \left(
        \ket{0}\frac{I + U}{2}\ket{\psi_\text{in}}
    \right) \\
    &=
    \bra{\psi_\text{in}}
    \frac{I + U + U^\dagger + U^\dagger U}{4}
    \ket{\psi_\text{in}} \\
    &=
    \bra{\psi_\text{in}}
    \frac{2I + U + U^\dagger}{4}
    \ket{\psi_\text{in}} \\
    &=
    \frac{1 + \Re\bra{\psi_\text{in}}U\ket{\psi_\text{in}}}{2}
\end{align}
となり、
第一のqubitが$\ket{1}$である確率は
\begin{align}
    p_1
    &=
    \left|
        (\ket{1}\bra{1} \otimes I)
        \left(
            \ket{0}\frac{I + U}{2}\ket{\psi_\text{in}}
            +
            \ket{1}\frac{I - U}{2}\ket{\psi_\text{in}}
        \right)
    \right|^2 \\
    &=
    \left|
        \ket{1}\frac{I - U}{2}\ket{\psi_\text{in}}
    \right|^2 \\
    &=
    \left(
        \bra{\psi_\text{in}}\frac{I - U^\dagger}{2}\bra{1}
    \right)
    \left(
        \ket{1}\frac{I - U}{2}\ket{\psi_\text{in}}
    \right) \\
    &=
    \bra{\psi_\text{in}}
    \frac{I - U - U^\dagger + U^\dagger U}{4}
    \ket{\psi_\text{in}} \\
    &=
    \bra{\psi_\text{in}}
    \frac{2I - U - U^\dagger}{4}
    \ket{\psi_\text{in}} \\
    &=
    \frac{1 - \Re\bra{\psi_\text{in}}U\ket{\psi_\text{in}}}{2}
\end{align}
となる。
従って、この回路では演算子$U$の$\bra{\psi_\text{in}}$における期待値を推定することができる。

測定の結果、第一番目のqubitが$\ket{0}, \ket{1}$だった場合、
残りの状態はそれぞれ、
\begin{align}
    \ket{\psi_\text{out}}
    =
    \ket{\psi_0}
    =
    \frac{I + U}{2}
    \ket{\psi_\text{in}}, \quad
    %
    \ket{\psi_\text{out}}
    =
    \ket{\psi_1}
    =
    \frac{I - U}{2}
    \ket{\psi_\text{in}}
\end{align}
となる。



\subsection{量子フーリエ変換}
$x_j$を$2^n$成分ベクトルとする。
これは規格化$\sum_{j=0}^{2^n-1} |x_j|^2 = 1$
されているとする。
この離散フーリエ変換
\begin{align}
    y_k 
    = 
    \frac{1}{\sqrt{2^n}}
    \sum_{j=0}^{2^n-1} x_j e^{i\frac{2\pi jk}{2^n}}
\end{align}
を量子回路を用いて計算する方法について述べる。

整数$j$に対してその2進数表記をラベルに持つような量子状態を考え、
次のように書く。
\begin{align}
    \ket{(j)_2} = \ket{i_1 i_2 \cdots}
\end{align}
例えば
\begin{align}
    \ket{(6)_2} 
    = 
    \ket{110} 
    = 
    \ket{1} \otimes \ket{1} \otimes \ket{0} 
    =
    \begin{pmatrix}
        0 \\ 0 \\ 0 \\ 0 \\ 0 \\ 0 \\ 1 \\ 0
    \end{pmatrix}
\end{align}
である。
この約束のもと、次のような状態を考える
\begin{align}
    \ket{x}\rangle 
    \equiv 
    \sum_{j=0}^{2^n-1} x_j \ket{(j)_2}, \quad
    %
    \ket{y}\rangle 
    \equiv 
    \sum_{j=0}^{2^n-1} y_j \ket{(j)_2}
\end{align}
$\ket{y}\rangle$を$x_j$で表すと
\begin{align}
    \ket{y}\rangle 
    &=
    \sum_{k=0}^{2^n-1} y_k \ket{(k)_2} \\
    &=
    \frac{1}{\sqrt{2^n}}
    \sum_{j=0}^{2^n-1}     
    \sum_{k=0}^{2^n-1}
    x_j e^{i\frac{2\pi jk}{2^n}}
    \ket{(k)_2} \\
    &=
    \sum_{j=0}^{2^n-1}     
    x_j
    \left(
        \frac{1}{\sqrt{2^n}}
        \sum_{k=0}^{2^n-1}
        e^{i\frac{2\pi jk}{2^n}}
        \ket{(k)_2}    
    \right)
\end{align}
となる。
もし、あるユニタリー変換で、
\begin{align}
    U \ket{(j)_2}
    =
    \frac{1}{\sqrt{2^n}}
    \sum_{k=0}^{2^n-1}
    e^{i\frac{2\pi jk}{2^n}}
    \ket{(k)_2}    
\end{align}
となるようなものがあったとすると、
\begin{align}
    U \ket{x}\rangle 
    =
    \ket{y}\rangle
\end{align}
となる。
$\ket{y}\rangle$の係数を読み取ることで、
フーリエ変換の結果を知ることができる。

以下で、そのような$U$を具体的に構成する。
ビット数は$n$で固定する。
\begin{align}
    \sum_{k=0}^{2^n-1}
    e^{i\frac{2\pi jk}{2^n}}
    \ket{(k)_2}    
    &=
    \sum_{k_1=0,1}
    \cdots 
    \sum_{k_n=0,1}
    e^{i\frac{2\pi j (k_12^{n-1} + \cdots + k_02^{0})}{2^n}}
    \ket{k_1 \cdots k_n} \\
    &=
    \sum_{k_1=0,1}
    \cdots 
    \sum_{k_n=0,1}
    e^{i 2\pi j (k_12^{-1} + \cdots + k_02^{-n})}
    \ket{k_1 \cdots k_n} \\  
    &=
    \left(
        \sum_{k_1=0,1}
        e^{i2\pi j k_1 2^{-1}}
        \ket{k_1}
    \right)
    \otimes 
    \cdots 
    \otimes 
    \left(
        \sum_{k_n=0,1}
        e^{i2\pi j k_n 2^{-n}}
        \ket{k_n}
    \right) \\
    &=
    \left(
        \ket{0} 
        + 
        e^{i2\pi j 2^{-1}} \ket{1}
    \right)
    \otimes 
    \cdots 
    \otimes 
    \left(
        \ket{0} 
        + 
        e^{i2\pi j 2^{-n}} \ket{1}
    \right)
\end{align}
ここで、$j2^{-l}$という因子の2進数表記について考える。
\begin{align}
    (j)_2 = j_1 j_2 \cdots j_n 
\end{align}
とすると、 
\begin{align}
    j = j_1 2^{n-1} + j_2 2^{n-2} + \cdots + j_n2^0
\end{align}
であるから
\begin{align}
    j2^{-l} = j_1 2^{n-l-1} + j_2 2^{n-l-2} + \cdots + j_n2^{-l}
\end{align}
である。
よって、これを2進数表記すると
\begin{align}
    (j2^{-1})_2 &= (\text{整数部分}).j_n \\
    (j2^{-2})_2 &= (\text{整数部分}).j_{n-1}j_n \\
    \vdots& \\
    (j2^{-l})_2 &= (\text{整数部分}).j_{n-l+1}\cdots j_{n-1}j_n \\
    \vdots& \\
    (j2^{-n})_2 &= (\text{整数部分}).j_{1}\cdots j_{n-1}j_n \\
\end{align}
となる。
また、一般に
\begin{align}
    e^{i 2\pi j_1 \cdots j_{l-1}. j_l \cdots j_n}
    &=
    e^{
        i 2\pi 
        \left(
            \dots
            +
            j_{l-2}2^1
            +
            j_{l-1} 
            +
            \frac{j_l}{2^1}
            \cdots
            +
            \frac{j_n}{2^{n-l+1}}       
        \right)
    } \\
    &=
    \cdots
    e^{i 2\pi j_{l-2}2^1}
    e^{i 2\pi j_{l-1}}
    e^{i 2\pi \frac{j_l}{2^1}}
    \cdots
    e^{i 2\pi \frac{j_n}{2^{n-l+1}}} \\
    &=
    e^{i 2\pi \frac{j_l}{2^1}}
    \cdots
    e^{i 2\pi \frac{j_n}{2^{n-l+1}}} \\
    &=
    e^{
        i 2\pi 
        \left(
            \frac{j_l}{2^1}
            \cdots
            +
            \frac{j_n}{2^{n-l+1}}       
        \right)
    }\\
    &=
    e^{i 2\pi 0. j_l \cdots j_n}
\end{align}
のように整数部分は効いてこないことに注意すると、
\begin{align}
    \sum_{k=0}^{2^n-1}
    e^{i\frac{2\pi jk}{2^n}}
    \ket{(k)_2}    
    &=
    \left(
        \ket{0} 
        + 
        e^{i2\pi j 2^{-1}} \ket{1}
    \right)
    \otimes 
    \cdots 
    \otimes 
    \left(
        \ket{0} 
        + 
        e^{i2\pi j 2^{-n}} \ket{1}
    \right) \\
    &=
    \left(
        \ket{0} 
        + 
        e^{i2\pi 0.j_n} \ket{1}
    \right)
    \otimes 
    \cdots 
    \otimes 
    \left(
        \ket{0} 
        + 
        e^{i2\pi 0.j_1 \cdots j_n} \ket{1}
    \right)
\end{align}
を得る。
よって、求めるべきユニタリー変換$U$とは
\begin{align}
    U \ket{(j)_2}
    =
    \frac{1}{\sqrt{2^n}}
    \left(
        \ket{0} 
        + 
        e^{i2\pi 0.j_n} \ket{1}
    \right)
    \otimes 
    \cdots 
    \otimes 
    \left(
        \ket{0} 
        + 
        e^{i2\pi 0.j_1 \cdots j_n} \ket{1}
    \right)
\end{align}
となるようなものである。

まず、Hadamardゲートが状態に対して
\begin{align}
    H \ket{j} 
    = \frac{\ket{0} + (-1)^{j}\ket{1}}{\sqrt{2}}
\end{align}
と作用することを思い出す。
ここで、2進小数を導入すると
\begin{align}
    e^{i 2\pi 0.0} = 1, \quad 
    e^{i 2\pi 0.1} = e^{\frac{i 2\pi}{2}} = -1
\end{align}
であるから、
\begin{align}
    H \ket{j} 
    = \frac{\ket{0} + e^{i 2\pi 0.j}\ket{1}}{\sqrt{2}}
\end{align}
と表すことができる。
このことを用い、まず第一番目のbitにHadamardゲートを作用させると
\begin{align}
    (H \otimes I \otimes \cdots)\ket{j_1j_2\cdots j_n}
    =
    \left(
        \frac{\ket{0} + e^{i 2\pi 0.j_1}\ket{1}}{\sqrt{2}}
    \right)
    \ket{j_2\cdots j_n}
\end{align}
となる。
次に、2番目のbitを制御ゲートとする位相ゲート$R_2$を一番目のゲートに作用させる。
3番目以降のbitは関与しないから、1,2番目のbitだけに注目して計算してみる。
\begin{align}
    \left(
        I \otimes \ket{0}\bra{0}
        + 
        R_2 \otimes \ket{1}\bra{1}
    \right)
    \left(
        \frac{\ket{0} + e^{i 2\pi 0.j_1}\ket{1}}{\sqrt{2}}
    \right)
    \ket{0}
    &=
    \frac{\ket{00} + e^{i 2\pi 0.j_1}\ket{10}}{\sqrt{2}}
    =
    \frac{\ket{00} + e^{i 2\pi 0.j_10}\ket{10}}{\sqrt{2}} \\
    %
    \left(
        I \otimes \ket{0}\bra{0}
        + 
        R_2 \otimes \ket{1}\bra{1}
    \right)
    \left(
        \frac{\ket{0} + e^{i 2\pi 0.j_1}\ket{1}}{\sqrt{2}}
    \right)
    \ket{1}
    &=
    \left(
        \frac{\ket{0} + e^{i\frac{2\pi}{2^2}}e^{i 2\pi 0.j_1}\ket{1}}{\sqrt{2}}
    \right)
    \ket{1}
    =
    \frac{\ket{01} + e^{i 2\pi 0.j_11}\ket{11}}{\sqrt{2}}
\end{align}
この結果をまとめると、
\begin{align}
    \left(
        I \otimes \ket{0}\bra{0}
        + 
        R_2 \otimes \ket{1}\bra{1}
    \right)
    \left(
        \frac{\ket{0} + e^{i 2\pi 0.j_1}\ket{1}}{\sqrt{2}}
    \right)
    \ket{j_2}
    =
    \frac{\ket{0} + e^{i 2\pi 0.j_1j_2}\ket{1}}{\sqrt{2}}
    \ket{j_2}
\end{align}
となる。
まったく同様の計算により、
\begin{align}
    C_{n,1}(R_n)
    \cdots
    C_{3,1}(R_3)
    C_{2,1}(R_2)
    H_1
    \ket{j_1j_2j_3\cdots j_n}
    =
    \frac{\ket{0} + e^{i 2\pi 0.j_1j_2j_3\cdots j_n}\ket{1}}{\sqrt{2}}
    \ket{j_2j_3\cdots j_n}
\end{align}
となる。
以下、残った$\ket{j_2j_3\cdots j_n}$の部分に同様な操作を施す。
\begin{align}
    C_{n-1,2}(R_n)
    \cdots
    C_{3,2}(R_4)
    C_{2,2}(R_3)
    H_2
    \ket{\bullet j_2j_3\cdots j_n}
    &=
    \frac{\ket{0} + e^{i 2\pi 0.j_2j_3\cdots j_n}\ket{1}}{\sqrt{2}}
    \ket{j_3\cdots j_n} \\
    %
    C_{n-1,3}(R_n)
    \cdots
    C_{3,3}(R_5)
    C_{2,3}(R_4)
    H_3
    \ket{\bullet\bullet j_3\cdots j_n}
    &=
    \frac{\ket{0} + e^{i 2\pi 0.j_3\cdots j_n}\ket{1}}{\sqrt{2}}
    \ket{j_4\cdots j_n} \\
    %
    & \vdots
\end{align}
これらをすべて合わせると、
\begin{align}
    \ket{j_1j_2 \cdots j_n}
    \to
    \frac{1}{\sqrt{2^n}}
    \left(
        \ket{0} 
        + 
        e^{i2\pi 0.j_1 \cdots j_n} \ket{1}
    \right)
    \otimes 
    \cdots 
    \otimes 
    \left(
        \ket{0} 
        + 
        e^{i2\pi 0.j_n} \ket{1}
    \right)
\end{align}
を得る。最後にSWAPゲートで状態の入れ替えを行えば完了である。


\subsection{位相推定アルゴリズム}
ユニタリー演算子$U$が固有値$e^{i\lambda_l}$をもち、
対応する固有状態が$\ket{\psi_l}$であるとする。
固有値の位相は$0 \leq \lambda_l \leq 2\pi$として一般性を失わないから、
$\lambda_l/2\pi$は次のように2進展開できる:
\begin{align}
    \frac{\lambda_l}{2\pi}
    =
    \frac{j_1^{(l)}}{2^1} + \cdots + \frac{j_n^{(l)}}{2^n}
\end{align}
ただし、展開が無限次になる場合は、$n$桁で打ち切って近似しているものと考える。
これを次のように表す。
\begin{align}
    \lambda_l = (2\pi) 0.j_1^{(l)}\cdots j_n^{(l)}
\end{align}
一般の量子状態$\ket{\psi}$を$U$の固有状態で展開したときの係数を$c_l$と表すことができる。
\begin{align}
    \ket{\psi} = \sum_l c_l \ket{\psi_l}
\end{align}
このとき、$\ket{\psi}$と$n$桁の補助量子ビット$\ket{00\dots 0}$を
\begin{align}
    V\ket{00\dots 0}\ket{\psi}
    =
    \sum_l c_l \ket{j_1^{(l)}\cdots j_n^{(l)}} \ket{\psi_l}
\end{align}
のように変換するアルゴリズムを量子位相推定と呼ぶ。
例えば、補助ビットが$\ket{0\cdots 0}$となる確率は
\begin{align}
    &\left|
        \ket{0\cdots 0}\bra{0\cdots 0} \otimes I 
        \sum_l c_l \ket{j_1^{(l)}\cdots j_n^{(l)}} \ket{\psi_l}
    \right|^2 \\
    =
    &\left|
        \sum_l c_l 
        \ket{0\cdots 0}\bra{0\cdots 0}\ket{j_1^{(l)}\cdots j_n^{(l)}} 
        \ket{\psi_l}
    \right|^2 \\
    =
    &\sum_{ll'} c_l c_{l'}^* 
    \bra{\psi_{l'}}
    \bra{j_1^{(l')}\cdots j_n^{(l')}}\ket{0\cdots 0}
    \bra{0\cdots 0}
    \ket{0\cdots 0}
    \bra{0\cdots 0} \ket{j_1^{(l)}\cdots j_n^{(l)}} 
    \ket{\psi_l} \\
    =
    &\sum_{ll'} c_l c_{l'}^* \delta_{ll'}
    \bra{j_1^{(l')}\cdots j_n^{(l')}}\ket{0\cdots 0}
    \bra{0\cdots 0} \ket{j_1^{(l)}\cdots j_n^{(l)}} \\ 
    =
    &\sum_{l} |c_l|^2 
    \bra{j_1^{(l)}\cdots j_n^{(l)}}\ket{0\cdots 0}
    \bra{0\cdots 0} \ket{j_1^{(l)}\cdots j_n^{(l)}} \\
    =
    &\sum_{l} |c_l|^2 
    \left| \bra{0\cdots 0} \ket{j_1^{(l)}\cdots j_n^{(l)}} \right|^2
\end{align}


まず準備として、ひとつの補助ビットと$U$の固有状態のテンソル積状態を考え、
それにHadamardゲートと制御$U^{2^k}$ゲートを作用させる。
\begin{align}
    C_1(U^{2^{k}}_{2}) H_1 \ket{0}\ket{\psi_l}
    &=
    C_1(U^{2^{k}}_{2}) 
    \frac{\ket{0} + \ket{1}}{\sqrt{2}}
    \ket{\psi_l} \\
    &=
    \frac{\ket{0}}{\sqrt{2}}
    \ket{\psi_l}
    +
    \frac{\ket{1}}{\sqrt{2}} 
    U^{2^{k}}\ket{\psi_l} \\
    &=
    \frac{\ket{0} + e^{2^ki\lambda_l} \ket{1}}{\sqrt{2}}
    \ket{\psi_l}
\end{align}
ここで、
\begin{align}
    2^0 \lambda_l 
    &=
    (2\pi) 2^0 0.j_1^{(l)} \cdots j_n^{(l)}
    =
    (2\pi) 0.j_2^{(l)} \cdots j_n^{(l)} \\
    %
    2^1 \lambda_l 
    &=
    (2\pi) 2^1 0.j_1^{(l)} \cdots j_n^{(l)}
    =
    (2\pi) j_1^{(l)}.j_2^{(l)} \cdots j_n^{(l)} \\
    %
    2^2 \lambda_l 
    &=
    (2\pi) 2^2 0.j_1^{(l)} \cdots j_n^{(l)}
    =
    (2\pi) j_1^{(l)}j_2^{(l)}.j_3^{(l)} \cdots j_n^{(l)} \\
    %
    &\vdots \\
    %
    2^k \lambda_l 
    &=
    (2\pi) 2^k 0.j_1^{(l)} \cdots j_n^{(l)}
    =
    (2\pi) j_1^{(l)} \cdots j_k^{(l)}.j_{k+1}^{(l)} \cdots j_n^{(l)}
\end{align}
であるから、
\begin{align}
    C_1(U^{2^{k}}_{2}) H_1 \ket{0}\ket{\psi_l}
    &=
    \frac{\ket{0} + e^{2^ki\lambda_l} \ket{1}}{\sqrt{2}}
    \ket{\psi_l} \\
    &=
    \frac{\ket{0} + e^{(2\pi i) j_1^{(l)} \cdots j_k^{(l)}.j_{k+1}^{(l)} \cdots j_n^{(l)}} \ket{1}}{\sqrt{2}}
    \ket{\psi_l} \\
    &=
    \frac{\ket{0} + e^{(2\pi i) 0.j_{k+1}^{(l)} \cdots j_n^{(l)}} \ket{1}}{\sqrt{2}}
    \ket{\psi_l}
\end{align}
を得る。
この結果を用いると、
\begin{align}
    &\prod_{k=1}^n C_k(U^{2^{k-1}}_{2}) H_k \ket{00\cdots 0}\ket{\psi_l} \\
    =
    &\frac{1}{\sqrt{2^n}}
    \left(
        \ket{0} + e^{(2\pi i) 0.j_{1}^{(l)} \cdots j_n^{(l)}} \ket{1}
    \right)
    \left(
        \ket{0} + e^{(2\pi i) 0.j_{2}^{(l)} \cdots j_n^{(l)}} \ket{1}
    \right)
    \cdots 
    \left(
        \ket{0} + e^{(2\pi i) 0.j_n^{(l)}} \ket{1}
    \right)
    \ket{\psi_l}
\end{align}
となるが、これは$\ket{j_1j_2 \cdots j_n}$に量子フーリエ変換を施してできる状態に他ならない。
従って、
\begin{align}
    \mathrm{QFT}^{\dagger }\prod_{k=1}^n C_k(U^{2^{k-1}}_{2}) H_k \ket{00\cdots 0}\ket{\psi_l} 
    =
    \ket{j_1^{(l)}j_2^{(l)} \cdots j_n^{(l)}}\ket{\psi_l}
\end{align}
である。
よって、$V = \mathrm{QFT}^{\dagger }\prod_{k=1}^n C_k(U^{2^{k-1}}_{2}) H_k$
とすれば良いことが分かった。



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{誤り訂正}
\subsection{線形符号による古典誤り訂正}
最も素朴な誤り訂正の方法は多数決である。
例えば、$0$というデータがあったとき、
これを$000$という風に冗長化したデータを作っておけば、
何らかの要因によってビットが部分的に反転してしまい
$010$になったとしても、
反転前のデータは$000$であろうと推定できる。

$k$ビットの情報$v$（成分が$0$ or $1$の$k$成分ベクトル）
があったとし、
これを$n = dk$ビットのベクトルに冗長化することを考える。
冗長化後のベクトルを$v'$, $v$から$v'$への変換を$G$とする。 
\begin{align}
    v' = Gv
\end{align}
$G$は$n \times k$行列である。
この操作を符号化、
$G$を生成行列と呼ぶ。
$G$として冒頭の多数決方式を採用したものを
線形符号と呼ぶ。
例えば、
\begin{align}
    v 
    =
    \begin{pmatrix}
        0 \\ 1 \\ 0
    \end{pmatrix},
    \quad 
    G
    =
    \begin{pmatrix}
        1 & 0 & 0 \\
        1 & 0 & 0 \\
        1 & 0 & 0 \\
        0 & 1 & 0 \\
        0 & 1 & 0 \\
        0 & 1 & 0 \\
        0 & 0 & 1 \\
        0 & 0 & 1 \\
        0 & 0 & 1
    \end{pmatrix},
\end{align}
と取れば、
\begin{align}
    v' = 
    \begin{pmatrix}
        0 \\ 0 \\ 0 \\ 
        1 \\ 1 \\ 1 \\ 
        0 \\ 0 \\ 0
    \end{pmatrix}
\end{align}
となる。

次に、エラーが起きたかどうかを判定する方法を考える。
$n$ビットのベクトルのうち、
$Gv$の形に表されるもの全体の集合を$W$とする。
$W$の元を符号語と呼ぶ。
例えば($k=2$, $d=3$)
\begin{align}
    v = 
    \begin{pmatrix}
    1 \\ 1 \\ 1 \\ 0 \\ 0 \\ 0    
    \end{pmatrix}
\end{align}
は符号語だが、
\begin{align}
    v = 
    \begin{pmatrix}
    1 \\ 0 \\ 1 \\ 0 \\ 0 \\ 0
    \end{pmatrix}
\end{align}
ではない。

各列ベクトルが独立で、$H_cG\equiv 0$ (mod 2)を満たすような
$(n-k) \times n$行列$H_c$があったとする。
これを検査行列と呼ぶ。
任意の符号語$w$について
\begin{align}
    H_c w = H_c Gv = 0
\end{align}
が成り立つ。
また逆に、$H_c w = 0$ならば、
$w$は符号語であることも示せるらしい。
このようにして、符号語の2通りの特徴付けを得た。
\begin{itemize}
    \item $G$を用いた見方: ベクトルが適切に水増しされている。
    \item $H_c$を用いた見方: ブロック内の隣接するビットが等しい。
\end{itemize}

$w \in W$のときに限りゼロになるような
ベクトル$s = H_c w$を$w$のシンドローム、
その成分をシンドローム値と呼ぶ。
ひとつでも0でないシンドローム値があれば、
$w$にはエラーが起きていることになる。
シンドローム値がすべて0のときは、
$w$にはエラーがないか、
エラー自身が$H_c e = 0$を満たしているかのどちらかである。



（例 $k=3, n=9$）
線形符号$G$に対する検査行列は以下を取ればよい。
\begin{align}
    H_c
    =
    \begin{pmatrix}
        1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 1 & 1 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 1 & 1 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 1 & 1 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 1
    \end{pmatrix}
\end{align}
実際
\begin{align}
    \begin{pmatrix}
        1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 1 & 1 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 1 & 1 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 1 & 1 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 1
    \end{pmatrix}    
    \begin{pmatrix}
        1 & 0 & 0 \\
        1 & 0 & 0 \\
        1 & 0 & 0 \\
        0 & 1 & 0 \\
        0 & 1 & 0 \\
        0 & 1 & 0 \\
        0 & 0 & 1 \\
        0 & 0 & 1 \\
        0 & 0 & 1
    \end{pmatrix}
    =
    \begin{pmatrix}
        2 & 0 & 0 \\
        2 & 0 & 0 \\
        0 & 2 & 0 \\
        0 & 2 & 0 \\
        0 & 0 & 2 \\
        0 & 0 & 2
    \end{pmatrix}
    \equiv 
    \begin{pmatrix}
        0 & 0 & 0 \\
        0 & 0 & 0 \\
        0 & 0 & 0 \\
        0 & 0 & 0 \\
        0 & 0 & 0 \\
        0 & 0 & 0
    \end{pmatrix}
\end{align}
となりOKである。
符号語$w$に対して$H_c w$を計算すると、
\begin{align}
    H_c w 
    =    
    \begin{pmatrix}
        1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 1 & 1 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 1 & 1 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 1 & 1 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 1
    \end{pmatrix}    
    \begin{pmatrix}
        0 \\ 0 \\ 0 \\ 
        1 \\ 1 \\ 1 \\ 
        0 \\ 0 \\ 0
    \end{pmatrix}
    =
    \begin{pmatrix}
        0 \\ 0 \\
        2 \\ 2 \\
        0 \\ 0 \\
    \end{pmatrix}
    \equiv
    \begin{pmatrix}
        0 \\ 0 \\
        0 \\ 0 \\
        0 \\ 0 \\
    \end{pmatrix}
\end{align}
となる。
もしエラーが混入していると、
\begin{align}
    H_c w 
    =    
    \begin{pmatrix}
        1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 1 & 1 & 0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 1 & 1 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 1 & 1 & 0 \\
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 1
    \end{pmatrix}    
    \left(
        \begin{pmatrix}
            0 \\ 0 \\ 0 \\ 
            1 \\ 1 \\ 1 \\ 
            0 \\ 0 \\ 0
        \end{pmatrix}
        +
        \begin{pmatrix}
            0 \\ 0 \\ 0 \\ 
            1 \\ 0 \\ 0 \\ 
            0 \\ 0 \\ 0
        \end{pmatrix}
    \right)
    =
    \left(
        \begin{pmatrix}
            0 \\ 0 \\
            2 \\ 2 \\
            0 \\ 0 \\
        \end{pmatrix}
        +
        \begin{pmatrix}
            0 \\ 0 \\
            1 \\ 0 \\
            0 \\ 0 \\
        \end{pmatrix}
    \right)
    \equiv
    \begin{pmatrix}
        0 \\ 0 \\
        1 \\ 0 \\
        0 \\ 0 \\
    \end{pmatrix}
\end{align}
となる。



\subsection{量子誤り訂正}
現在知られている量子誤り訂正は、
線形符号を量子計算版とでもいうべきものである。
具体例から考える。
1ビットの情報を3ビットに冗長化することを考える。
ここでは、符号化前の量子状態もあらかじめ3bitで用意しておき、
情報は1bit目に格納しておくことにする。
よって符号化$G$として
\begin{align}
    \ket{000} &\to \ket{000} \\
    \ket{100} &\to \ket{111}
\end{align}
となるようなものを用意できれば良い。
これはCNOTゲート
\begin{align}
    \Lambda_{1,2}(X) 
    &=
    P_0 \otimes I \otimes I
    +
    P_1 \otimes X \otimes I \\
    %
    \Lambda_{1,3}(X) 
    &=
    P_0 \otimes I \otimes I
    +
    P_1 \otimes I \otimes X
\end{align}
で実現できる。
実際、
\begin{align}
    \Lambda_{1,2}(X)\Lambda_{1,3}(X)\ket{000}
    &=
    \ket{000} \\
    %
    \Lambda_{1,2}(X)\Lambda_{1,3}(X)\ket{100}
    &=
    \ket{111}
\end{align}
となる。

次にシンドロームを調べる方法を考える。
\begin{align}
    M_0^{(1)} = \frac{I + Z_1Z_2}{2}, \quad
    M_1^{(1)} = \frac{I - Z_1Z_2}{2}
\end{align}
という2つの演算子を考えると、これらはPOVMをなし、
\begin{align}
    M_0^{(1)} \ket{000} 
    &=
    \frac{1 + 1}{2} \ket{000}
    =
    \ket{000} \\
    %
    M_0^{(1)} \ket{100} 
    &=
    \frac{1 - 1}{2} \ket{100}
    =
    0 \\
    %
    M_0^{(1)} \ket{010} 
    &=
    \frac{1 - 1}{2} \ket{010}
    =
    0 \\
    %
    M_0^{(1)} \ket{110} 
    &=
    \frac{1 + 1}{2} \ket{110}
    =
    \ket{110}
\end{align}
\begin{align}
    M_1^{(1)} \ket{000} 
    &=
    \frac{1 - 1}{2} \ket{000}
    =
    0 \\
    %
    M_1^{(1)} \ket{100} 
    &=
    \frac{1 + 1}{2} \ket{100}
    =
    \ket{100} \\
    %
    M_1^{(1)} \ket{010} 
    &=
    \frac{1 + 1}{2} \ket{010}
    =
    \ket{010} \\
    %
    M_1^{(1)} \ket{110} 
    &=
    \frac{1 - 1}{2} \ket{110}
    =
    0
\end{align}
より、
\begin{align}
    \tr(\ket{ij0}\bra{ij0} M_0^{1})
    =
    \delta_{ij}, \\
    %
    \tr(\ket{ij0}\bra{ij0} M_1^{1})
    =
    1 - \delta_{ij}
\end{align}
となるから、
$M_1^{1}$の期待値が、1,2番のビットに関する
シンドローム値を与えることが分かる。
全く同様にして、
\begin{align}
    M_0^{(2)} = \frac{I + Z_2Z_3}{2}, \quad
    M_1^{(2)} = \frac{I - Z_2Z_3}{2}
\end{align}
も測定すれば、すべてのシンドローム値が得られる。
古典的な誤り訂正の場合、シンドローム値は0か1
であったが、
量子計算の場合はそれ以外の中途半端な値を取りうる。
例えば、$\ket{\psi} = (\ket{000} + \ket{010})/\sqrt{2}$
のとき、
\begin{align}
    M_0^{(1)}\ket{\psi}
    \frac{1}{\sqrt{2}}(\ket{000} + \ket{010})
    =
    \frac{\ket{000}}{\sqrt{2}}
\end{align}
より、
\begin{align}
    \tr(\ket{\psi}\bra{\psi}M_0^{(1)})
    =
    \frac{1}{2}
\end{align}
となる。

以下では簡単のため、
このような位相を変化させるエラーはなく、
ビット反転を引き起こすエラーのみを考える。
そのようなエラーを引き起こす操作は
\begin{align}
    E = X_1^{e_1} X_2^{e_1} X_3^{e_1}
\end{align}
と書ける。ただし、$e_1,e_2,e_3 = 0,1$である。
仮に、$\ket{000}$がオリジナルのデータで、
これに、$e_1 = 1, e_2 = e_3 = 0$のエラーが乗ったとすると、
\begin{align}
    E\ket{000}
    =
    X_1\ket{000}
    =
    \ket{100}
\end{align}
となる。
この状態のシンドローム値を完全に調べると、
1番目のビットに反転があることが分かるから、
状態に再度$X_1$を作用させれば
もとの状態を復元することができる。
\begin{align}
    R\ket{100} = X_1\ket{100} = \ket{000}
\end{align}
これでエラー訂正が完了した。



\subsection{スタビライザー符号}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Summary}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\bibliography{sample.bib}
%\bibliographystyle{h-physrev5}


\end{document}